ShopOfMe.Views.ListingPage=Support.CompositeView.extend({initialize:function(e){_.bindAll(this,"render"),this.items=e.items,this.user=e.user,this.filters=e.filters,this.no_items_template=e.no_items_template,this.child_views=[]},render:function(){return this.renderTemplate(),"1"!==localStorage.getItem("shopofmeShownIntro")&&window.show_intro===!0&&this.renderIntroBox(),this.renderScore(),this.renderFilters(),this.model?this.renderItemDetail():this.renderItemList(),this},renderTemplate:function(){this.$el.html(JST["shopofme_backbone_templates/items/listing_page"]())},renderIntroBox:function(){var e=this;this.$("#items").append(JST["shopofme_backbone_templates/items/intro_box"]()),this.$("#items p.close_intro").bind("click",function(){e.$(".intro_box").hide(),localStorage.setItem("shopofmeShownIntro","1")})},renderScore:function(){},renderFilters:function(){var e=this;the_filter_view=new ShopOfMe.Views.Filters({model:this.filters}),this.child_views.push(the_filter_view),e.renderChild(the_filter_view),e.$("#the_sidebar").append(the_filter_view.el),this.filters.bind("change",function(){e.items.fetch({data:{identifier:ShopOfMe.user.get("identifier"),filter:{gender:e.filters.get("gender"),category:e.filters.get("category"),minPrice:e.filters.get("minPrice"),maxPrice:e.filters.get("maxPrice")}},silent:!0,add:!0,success:function(){e.items.add()}})})},renderItemList:function(){self=this,this.filtered_items=this.items.filtered(),this.filtered_items.add(),the_list_view=new ShopOfMe.Views.ItemsIndex({collection:this.filtered_items,filters:this.filters}),this.child_views.push(the_list_view),self.renderChild(the_list_view),self.$("#items").append(the_list_view.el)},renderItemDetail:function(){self=this,this.model.fetch({success:function(){self.$("#items").html(JST["shopofme_backbone_templates/items/item_detail"]()),self.$(".main_image").attr("src",self.model.get("image_link")),self.$(".item_price").html("Â£"+self.model.get("the_price")+".00"),void 0===self.model.get("the_retailer")?self.$(".item_retailer").html(self.model.get("the_domain")):self.$(".item_retailer").html(self.model.get("the_retailer")),self.$(".outbound_link").attr("href",self.model.get("url"))}})},forceUnbind:function(){_.each(this.child_views.reverse,function(e){e.forceUnbind()}),this.remove(),this.unbind()}});